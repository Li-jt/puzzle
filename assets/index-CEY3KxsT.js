(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function o(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(t){if(t.ep)return;t.ep=!0;const c=o(t);fetch(t.href,c)}})();let l,f,s=[],a,u,y=3,x=3,n=null,p=0,w=0,v=0,L=0,g=!1,P;function C(){l=document.createElement("canvas"),f=l.getContext("2d"),document.body.appendChild(l);const e=document.createElement("input");e.type="file",e.accept="image/*",e.addEventListener("change",I),document.body.appendChild(e),l.addEventListener("mousedown",E),l.addEventListener("mousemove",z),l.addEventListener("mouseup",M),P=Date.now()}function I(e){var r;const o=(r=e.target.files)==null?void 0:r[0];if(o){const t=new FileReader;t.onload=c=>{var m;const d=new Image;d.src=(m=c.target)==null?void 0:m.result,d.onload=()=>{O(d)}},t.readAsDataURL(o)}}function O(e){l.width=e.width,l.height=e.height,a=e.width/y,u=e.height/x,s=[];let i=0;for(let o=0;o<x;o++)for(let r=0;r<y;r++)s.push({index:++i,x:r*a,y:o*u,img:e,sx:r*a,sy:o*u,width:a,height:u});b(),console.log("Pieces after shuffle:",s),h(),g=!1}function b(){for(let e=s.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[s[e].x,s[i].x]=[s[i].x,s[e].x],[s[e].y,s[i].y]=[s[i].y,s[e].y]}}function h(){f.clearRect(0,0,l.width,l.height),s.forEach(e=>{e!==n&&f.drawImage(e.img,e.sx,e.sy,e.width,e.height,e.x,e.y,e.width,e.height)}),n&&f.drawImage(n.img,n.sx,n.sy,n.width,n.height,n.x,n.y,n.width,n.height)}function E(e){const i=l.getBoundingClientRect(),o=e.clientX-i.left,r=e.clientY-i.top;for(let t of s)if(o>=t.x&&o<=t.x+t.width&&r>=t.y&&r<=t.y+t.height){n=t,p=o-t.x,w=r-t.y,v=t.x,L=t.y;break}}function z(e){if(n){const i=l.getBoundingClientRect(),o=e.clientX-i.left,r=e.clientY-i.top;n.x=o-p,n.y=r-w,h()}}function M(){if(n&&!g){const e=Math.round(n.x/a)*a,i=Math.round(n.y/u)*u;let o=s.find(r=>r.x===e&&r.y===i);if(o&&o!==n){[n.x,o.x]=[o.x,v],[n.y,o.y]=[o.y,L];const r=s.indexOf(n),t=s.indexOf(o);[s[r],s[t]]=[s[t],s[r]],X()}else n.x=e,n.y=i;h(),n=null}}function X(){for(let o of s)if(o.x!==o.sx||o.y!==o.sy)return;g=!0,h(),Y();const i=(Date.now()-P)/1e3;setTimeout(()=>{alert(`拼图完成！耗时: ${i.toFixed(2)} 秒`)},500)}function Y(){l.removeEventListener("mousedown",E),l.removeEventListener("mousemove",z),l.removeEventListener("mouseup",M)}C();
