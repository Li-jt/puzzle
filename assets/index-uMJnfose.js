(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=t(n);fetch(n.href,l)}})();let u,h,s=[],d,a,f=3,m=3,r=null,E=0,L=0,p=0,y=0,w=!1,I;function z(){u=document.createElement("canvas"),h=u.getContext("2d"),document.body.appendChild(u);const e=document.createElement("input");e.type="file",e.accept="image/*",e.addEventListener("change",C),document.body.appendChild(e);const o=document.createElement("input");o.type="number",o.min="1",o.id="input1",o.value=f.toString(),o.addEventListener("blur",()=>{f=parseInt(o.value,10),x(s[0].img)}),document.body.appendChild(o);const t=document.createElement("input");t.type="number",t.min="1",t.value=m.toString(),t.id="input2",t.addEventListener("blur",()=>{m=parseInt(t.value,10),x(s[0].img)}),document.body.appendChild(t),u.addEventListener("mousedown",b),u.addEventListener("mousemove",X),u.addEventListener("mouseup",M)}function C(e){var i;const t=(i=e.target.files)==null?void 0:i[0];if(t){const n=new FileReader;n.onload=l=>{var v;const c=new Image;c.src=(v=l.target)==null?void 0:v.result,c.onload=()=>{f=parseInt(document.querySelector("#input1").value,10),m=parseInt(document.querySelector("#input2").value,10),x(c)}},n.readAsDataURL(t)}}function x(e){u.width=e.width,u.height=e.height,d=e.width/f,a=e.height/m,s=[];let o=0;for(let t=0;t<m;t++)for(let i=0;i<f;i++)s.push({index:++o,x:i*d,y:t*a,img:e,sx:i*d,sy:t*a,width:d,height:a});D(),console.log("Pieces after shuffle:",s),g(),w=!1,I=Date.now()}function D(){for(let e=s.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1));[s[e].x,s[o].x]=[s[o].x,s[e].x],[s[e].y,s[o].y]=[s[o].y,s[e].y]}}function g(){h.clearRect(0,0,u.width,u.height),s.forEach(e=>{e!==r&&h.drawImage(e.img,e.sx,e.sy,e.width,e.height,e.x,e.y,e.width,e.height)}),r&&h.drawImage(r.img,r.sx,r.sy,r.width,r.height,r.x,r.y,r.width,r.height)}function b(e){const o=u.getBoundingClientRect(),t=e.clientX-o.left,i=e.clientY-o.top;for(let n of s)if(t>=n.x&&t<=n.x+n.width&&i>=n.y&&i<=n.y+n.height){r=n,E=t-n.x,L=i-n.y,p=n.x,y=n.y;break}}function O(e,o){let t,i;return(...n)=>{const l=this;i?(clearTimeout(t),t=setTimeout(()=>{Date.now()-i>=o&&(e.apply(l,n),i=Date.now())},o-(Date.now()-i))):(e.apply(l,n),i=Date.now())}}const X=O(P,16);function P(e){if(r){const o=u.getBoundingClientRect(),t=e.clientX-o.left,i=e.clientY-o.top;r.x=t-E,r.y=i-L,g()}}function M(){if(r&&!w){const e=Math.round(r.x/d)*d,o=Math.round(r.y/a)*a;let t=s.find(i=>i.x===e&&i.y===o);if(t&&t!==r){[r.x,t.x]=[t.x,p],[r.y,t.y]=[t.y,y];const i=s.indexOf(r),n=s.indexOf(t);[s[i],s[n]]=[s[n],s[i]],Y()}else r.x=p,r.y=y;g(),r=null}}function Y(){for(let t of s)if(t.x!==t.sx||t.y!==t.sy)return;w=!0,g(),R();const o=(Date.now()-I)/1e3;setTimeout(()=>{alert(`拼图完成！耗时: ${o.toFixed(2)} 秒`)},500)}function R(){u.removeEventListener("mousedown",b),u.removeEventListener("mousemove",P),u.removeEventListener("mouseup",M)}z();
